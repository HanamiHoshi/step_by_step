# handlers/start.py
from aiogram import Router, F
from aiogram.types import Message, ReplyKeyboardMarkup, KeyboardButton
from aiogram.filters import Command
from .habits import cmd_add_habit, cmd_today
from .stats import cmd_stats

router = Router()

@router.message(Command("start"))
async def cmd_start(message: Message):
    """–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –º–µ–Ω—é"""
    kb = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="üìö –ü–æ–º–æ—â—å"), KeyboardButton(text="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")],
            [KeyboardButton(text="‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É"), KeyboardButton(text="‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è")]
        ],
        resize_keyboard=True
    )

    await message.answer(
        "üëã –ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî *–®–∞–≥ –∑–∞ —à–∞–≥–æ–º* ‚Äî —Ç–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –ø–æ–ª–µ–∑–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫.\n\n"
        "üìå –ù–∞—á–Ω–∏ —Å –∫–æ–º–∞–Ω–¥—ã /add ‚Äî –¥–æ–±–∞–≤—å –ø–µ—Ä–≤—É—é –ø—Ä–∏–≤—ã—á–∫—É.\n"
        "‚úÖ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –æ—Ç–º–µ—á–∞–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Äî –∏ —è –ø–æ–º–æ–≥—É —Ç–µ–±–µ –Ω–µ —Å–±–∏—Ç—å—Å—è —Å –ø—É—Ç–∏!\n\n"
        "*–ú–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ ‚Äî –±–æ–ª—å—à–∏–µ –ø–µ—Ä–µ–º–µ–Ω—ã.* üö∂‚Äç‚ôÇÔ∏è",
        parse_mode="Markdown",
        reply_markup=kb
    )

@router.message(Command("help"))
async def cmd_help(message: Message):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º"""
    help_text = (
        "üê¢ *–ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî –ß–µ—Ä–µ–ø–∞—à–∫–∞ –°—Ç–µ–ø–∞, —Ç–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–µ–∫.*\n\n"
        "–í–æ—Ç —á—Ç–æ —è —É–º–µ—é:\n\n"
        "üîπ *–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:*\n"
        "`/add` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø—Ä–∏–≤—ã—á–∫—É\n"
        "`/list` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø—Ä–∏–≤—ã—á–∫–∏ —Å ID\n"
        "`/edit ID –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ` ‚Äî –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫—É\n"
        "`/delete ID` ‚Äî —É–¥–∞–ª–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)\n\n"
        "üîπ *–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞:*\n"
        "`/today` ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫\n"
        "`/remindme –ß–ß:–ú–ú` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/remindme 19:30`)\n"
        "`/remindme off` ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è\n\n"
        "üîπ *–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å:*\n"
        "`/stats` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–≤–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ —Ü–µ–ø–æ—á–∫–∏\n"
        "`/statsimg` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –≤–∏–¥–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ üñºÔ∏è\n"
        "`/resetstats` ‚Äî —Å–±—Ä–æ—Å–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–∏—Å—Ç–æ—Ä–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è), –ø—Ä–∏–≤—ã—á–∫–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è\n\n"
        "üîπ *–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å:*\n"
        "`/reset` ‚Äî —É–¥–∞–ª–∏—Ç—å –í–°–ï –ø—Ä–∏–≤—ã—á–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º) üóëÔ∏è\n\n"
        "üîπ *–ü–æ–º–æ—â—å –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è:*\n"
        "`/help` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ –º–µ–Ω—é —Å–Ω–æ–≤–∞\n"
        "`/start` ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –Ω–∞—á–∞–ª–æ\n\n"
        "üí° *–°–æ–≤–µ—Ç –æ—Ç –°—Ç–µ–ø—ã:*\n"
        "–ù–µ –±–æ–π—Å—è –Ω–∞—á–∏–Ω–∞—Ç—å –∑–∞–Ω–æ–≤–æ ‚Äî –¥–∞–∂–µ —á–µ—Ä–µ–ø–∞—à–∫–∏ –∏–Ω–æ–≥–¥–∞ –¥–µ–ª–∞—é—Ç —à–∞–≥ –Ω–∞–∑–∞–¥, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –ø—Ä—ã–≥–Ω—É—Ç—å –≤–ø–µ—Ä—ë–¥! üê¢\n\n"
        "–ù–∞—á–Ω–∏ —Å `/add` ‚Äî –∏ —è –ø–æ–º–æ–≥—É —Ç–µ–±–µ –Ω–µ —Å–±–∏—Ç—å—Å—è —Å –ø—É—Ç–∏!"
    )

    await message.answer(help_text, parse_mode="Markdown")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
@router.message(F.text == "üìö –ü–æ–º–æ—â—å")
async def btn_help(message: Message):
    await cmd_help(message)

@router.message(F.text == "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
async def btn_stats(message: Message):
    await cmd_stats(message)

@router.message(F.text == "‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É")
async def btn_add(message: Message):
    # –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π –≤—ã–∑–æ–≤ ‚Äî –±–µ–∑ FSM, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ /add
    # –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –ø–æ–∑–∂–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    await message.answer("üìù –í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ø—Ä–∏–≤—ã—á–∫–∏:")
    # –í –∏–¥–µ–∞–ª–µ ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å FSM, –Ω–æ –¥–ª—è MVP ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—Å–∫–∞–∑–∫–∞
    # –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π FSM –ª—É—á—à–µ –≤—ã–∑—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É /add

@router.message(F.text == "‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è")
async def btn_today(message: Message):
    await cmd_today(message)